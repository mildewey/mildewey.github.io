import{S as A,i as M,s as T,l as N,g as d,r as p,x as j,y as C,z as O,p as g,C as k,o as L,q as P,F as Y,d as _,e as y,H as W,k as E,t as G,c as $,a as w,G as X,m as S,h as Q,b as K,I as v,J as Z,j as I,K as D,L as x,M as ee,N as te}from"../chunks/index-bd8f1dbb.js";import{j as le}from"../chunks/controls-ef78b98b.js";import{g as ne,a as se}from"../chunks/navigation-13fd7038.js";import"../chunks/singletons-d1fb5791.js";async function V(a,e){const t=await(await e(a)).text();return le.load(t)}async function ae(a,e){const n=await Promise.all(a.elements.map(t=>V(t,e)));return Object.assign(...n)}async function re(a,e){const n=await Promise.all(a.prototypes.map(t=>V(t,e)));return Object.assign(...n)}function oe(a,e){return Object.entries(e).forEach(([n,t])=>{n in a?a[n]+=t:a[n]=t}),a}function B(a,e,n,t){if(!(t in a.elements))return console.log(`Couldn't find ${t} in system ${a.name}.`),!1;let l=a.elements[t];return"powers"in l&&l.powers.forEach(r=>e.powers.add(r)),"stats"in l&&oe(e.stats,l.stats),"slots"in l&&Object.keys(l.slots).forEach(r=>{const s=l.slots[r],f=`${t}.${r}`;e.slots[f]={name:s.name,options:Object.assign({unselected:{name:"Unselected"}},...s.allowedTags.map(o=>a.tags[o]))},B(a,e,n,n.elements[f])}),"upgrades"in l&&(e.upgrades[t]={name:l.name,options:{}},l.upgrades.forEach(r=>{e.upgrades[t].options[r]=a.elements[r]}),`${t}.upgrades`in n.elements?n.elements[`${t}.upgrades`].forEach(r=>{B(a,e,n,r)&&(e.level+=1)}):n.elements[`${t}.upgrades`]=[]),!0}function ie(a,e){const n={name:e.name,blurb:e.blurb,level:0,stats:{},slots:{character:{name:"Character Type",options:Object.assign({null:{name:"Unselected"}},a.tags.character)}},upgrades:{},powers:new Set};return B(a,n,e,e.elements.character),n.powers=[...n.powers.values()],n}async function fe(a,e){const n=await V(`/${a}/index.yaml`,e),t={sysID:a,name:n.name,elements:"elements"in n?await ae(n,e):{},prototypes:"prototypes"in n?await re(n,e):{},tags:{}};return Object.entries(t.elements).forEach(([l,r])=>{t.elements[l].tags.forEach(s=>{s in t.tags||(t.tags[s]={}),t.tags[s][l]=r})}),t.inflateCharacter=l=>ie(t,l),t}function R(a,e,n){const t=a.slice();return t[6]=e[n],t}function q(a){let e,n,t=a[0].children,l=[];for(let s=0;s<t.length;s+=1)l[s]=F(R(a,t,s));const r=s=>g(l[s],1,1,()=>{l[s]=null});return{c(){for(let s=0;s<l.length;s+=1)l[s].c();e=N()},l(s){for(let f=0;f<l.length;f+=1)l[f].l(s);e=N()},m(s,f){for(let o=0;o<l.length;o+=1)l[o].m(s,f);d(s,e,f),n=!0},p(s,f){if(f&3){t=s[0].children;let o;for(o=0;o<t.length;o+=1){const u=R(s,t,o);l[o]?(l[o].p(u,f),p(l[o],1)):(l[o]=F(u),l[o].c(),p(l[o],1),l[o].m(e.parentNode,e))}for(L(),o=t.length;o<l.length;o+=1)r(o);P()}},i(s){if(!n){for(let f=0;f<t.length;f+=1)p(l[f]);n=!0}},o(s){l=l.filter(Boolean);for(let f=0;f<l.length;f+=1)g(l[f]);n=!1},d(s){Y(l,s),s&&_(e)}}}function F(a){let e,n;return e=new z({props:{nav:a[6],level:a[1]+1}}),{c(){j(e.$$.fragment)},l(t){C(e.$$.fragment,t)},m(t,l){O(e,t,l),n=!0},p(t,l){const r={};l&1&&(r.nav=t[6]),l&2&&(r.level=t[1]+1),e.$set(r)},i(t){n||(p(e.$$.fragment,t),n=!0)},o(t){g(e.$$.fragment,t),n=!1},d(t){k(e,t)}}}function ce(a){let e,n,t,l=a[0].label+"",r,s,f,o,u,m,c=a[0].children&&a[2]&&q(a);return{c(){e=y("div"),n=new W(!1),t=E(),r=G(l),s=E(),c&&c.c(),f=N(),this.h()},l(i){e=$(i,"DIV",{class:!0});var h=w(e);n=X(h,!1),t=S(h),r=Q(h,l),h.forEach(_),s=S(i),c&&c.l(i),f=N(),this.h()},h(){n.a=t,K(e,"class",a[3])},m(i,h){d(i,e,h),n.m(a[4],e),v(e,t),v(e,r),d(i,s,h),c&&c.m(i,h),d(i,f,h),o=!0,u||(m=Z(e,"click",a[5]),u=!0)},p(i,[h]){(!o||h&16)&&n.p(i[4]),(!o||h&1)&&l!==(l=i[0].label+"")&&I(r,l),(!o||h&8)&&K(e,"class",i[3]),i[0].children&&i[2]?c?(c.p(i,h),h&5&&p(c,1)):(c=q(i),c.c(),p(c,1),c.m(f.parentNode,f)):c&&(L(),g(c,1,1,()=>{c=null}),P())},i(i){o||(p(c),o=!0)},o(i){g(c),o=!1},d(i){i&&_(e),i&&_(s),c&&c.d(i),i&&_(f),u=!1,m()}}}function ue(a,e,n){let t,l,{nav:r}=e,{level:s=0}=e,f=!1;function o(){r.children?n(2,f=!f):r.href&&ne(r.href)}return a.$$set=u=>{"nav"in u&&n(0,r=u.nav),"level"in u&&n(1,s=u.level)},a.$$.update=()=>{a.$$.dirty&2&&n(4,t="&nbsp&nbsp".repeat(s)),a.$$.dirty&1&&n(3,l=`nav-section${r.href?" link":""}`)},[r,s,f,l,t,o]}class z extends A{constructor(e){super(),M(this,e,ue,ce,T,{nav:0,level:1})}}function me(a){let e,n;return e=new z({props:{nav:a[0]}}),{c(){j(e.$$.fragment)},l(t){C(e.$$.fragment,t)},m(t,l){O(e,t,l),n=!0},p(t,[l]){const r={};l&1&&(r.nav=t[0]),e.$set(r)},i(t){n||(p(e.$$.fragment,t),n=!0)},o(t){g(e.$$.fragment,t),n=!1},d(t){k(e,t)}}}function he(a,e,n){let{sys:t}=e,{sysKey:l}=e,r={};function s(f){return JSON.parse(localStorage.getItem(`${f}-characters`)||"{}")}return se((f,o)=>{const u=s(l);n(0,r={label:t.name,children:[{label:"Elements",children:Object.entries(t.elements).map(([m,c])=>({label:c.name,href:`/${l}/element/${m}`}))},{label:"Prototypes",children:Object.entries(t.prototypes).map(([m,c])=>({label:c.name,href:`/${l}/prototype/${m}`}))},{label:"Characters",children:[{label:"New Character",href:`/${l}/character/new`},...Object.entries(u).map(([m,c])=>({label:c.name,href:`/${l}/character/${m}`}))]},{label:"Adversaries"}]})}),a.$$set=f=>{"sys"in f&&n(1,t=f.sys),"sysKey"in f&&n(2,l=f.sysKey)},[r,t,l]}class pe extends A{constructor(e){super(),M(this,e,he,me,T,{sys:1,sysKey:2})}}function J(a,e,n){const t=a.slice();return t[2]=e[n][0],t[3]=e[n][1],t}function U(a){let e,n;return e=new pe({props:{sysKey:a[2],sys:a[3]}}),{c(){j(e.$$.fragment)},l(t){C(e.$$.fragment,t)},m(t,l){O(e,t,l),n=!0},p(t,l){const r={};l&1&&(r.sysKey=t[2]),l&1&&(r.sys=t[3]),e.$set(r)},i(t){n||(p(e.$$.fragment,t),n=!0)},o(t){g(e.$$.fragment,t),n=!1},d(t){k(e,t)}}}function _e(a){let e,n,t,l;n=new z({props:{nav:a[1]}});let r=Object.entries(a[0]),s=[];for(let o=0;o<r.length;o+=1)s[o]=U(J(a,r,o));const f=o=>g(s[o],1,1,()=>{s[o]=null});return{c(){e=y("nav"),j(n.$$.fragment),t=E();for(let o=0;o<s.length;o+=1)s[o].c()},l(o){e=$(o,"NAV",{});var u=w(e);C(n.$$.fragment,u),t=S(u);for(let m=0;m<s.length;m+=1)s[m].l(u);u.forEach(_)},m(o,u){d(o,e,u),O(n,e,null),v(e,t);for(let m=0;m<s.length;m+=1)s[m].m(e,null);l=!0},p(o,[u]){if(u&1){r=Object.entries(o[0]);let m;for(m=0;m<r.length;m+=1){const c=J(o,r,m);s[m]?(s[m].p(c,u),p(s[m],1)):(s[m]=U(c),s[m].c(),p(s[m],1),s[m].m(e,null))}for(L(),m=r.length;m<s.length;m+=1)f(m);P()}},i(o){if(!l){p(n.$$.fragment,o);for(let u=0;u<r.length;u+=1)p(s[u]);l=!0}},o(o){g(n.$$.fragment,o),s=s.filter(Boolean);for(let u=0;u<s.length;u+=1)g(s[u]);l=!1},d(o){o&&_(e),k(n),Y(s,o)}}}function ge(a,e,n){let{allSystems:t}=e,l={label:"Rules",children:[{label:"Combat",href:"/rules/combat"},{label:"Building a Character",href:"/rules/character"}]};return a.$$set=r=>{"allSystems"in r&&n(0,t=r.allSystems)},[t,l]}class de extends A{constructor(e){super(),M(this,e,ge,_e,T,{allSystems:0})}}function be(a){let e,n,t,l,r,s,f,o,u;e=new de({props:{allSystems:a[0]}});const m=a[2].default,c=D(m,a,a[1],null);return{c(){j(e.$$.fragment),n=E(),t=y("main"),c&&c.c(),l=E(),r=y("footer"),s=y("small"),f=G("built with Ersatz\u2122 \xA9 Mark Dewey and Stuart Cheney"),o=y("br"),this.h()},l(i){C(e.$$.fragment,i),n=S(i),t=$(i,"MAIN",{});var h=w(t);c&&c.l(h),h.forEach(_),l=S(i),r=$(i,"FOOTER",{class:!0});var b=w(r);s=$(b,"SMALL",{class:!0});var H=w(s);f=Q(H,"built with Ersatz\u2122 \xA9 Mark Dewey and Stuart Cheney"),H.forEach(_),o=$(b,"BR",{}),b.forEach(_),this.h()},h(){K(s,"class","dragonsteel"),K(r,"class","dragonsteel")},m(i,h){O(e,i,h),d(i,n,h),d(i,t,h),c&&c.m(t,null),d(i,l,h),d(i,r,h),v(r,s),v(s,f),v(r,o),u=!0},p(i,[h]){const b={};h&1&&(b.allSystems=i[0]),e.$set(b),c&&c.p&&(!u||h&2)&&x(c,m,i,i[1],u?te(m,i[1],h,null):ee(i[1]),null)},i(i){u||(p(e.$$.fragment,i),p(c,i),u=!0)},o(i){g(e.$$.fragment,i),g(c,i),u=!1},d(i){k(e,i),i&&_(n),i&&_(t),c&&c.d(i),i&&_(l),i&&_(r)}}}async function Se({params:a,fetch:e,session:n,stuff:t}){let l={goliath:await fe("goliath",e)};return{status:200,props:{allSystems:l},stuff:{allSystems:l}}}function ye(a,e,n){let{$$slots:t={},$$scope:l}=e,{allSystems:r}=e;return a.$$set=s=>{"allSystems"in s&&n(0,r=s.allSystems),"$$scope"in s&&n(1,l=s.$$scope)},[r,l,t]}class je extends A{constructor(e){super(),M(this,e,ye,be,T,{allSystems:0})}}export{je as default,Se as load};
